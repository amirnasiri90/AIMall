/**
 * همهٔ بخش‌های پنل و کلیدواژه‌های راهنما («میخوای چه کار کنی؟»)
 * از هر جای پنل کاربر می‌تواند بپرسد و به بخش مناسب هدایت شود.
 * steps: مراحل خلاصه انجام کار در آن بخش (برای نمایش بعد از راهنمایی).
 */
export interface IntentTarget {
  href: string;
  label: string;
  desc: string;
  keywords: string[];
  steps?: string[];
}

export const INTENT_TARGETS: IntentTarget[] = [
  // ── داشبورد و تنظیمات ──
  { href: '/dashboard', label: 'داشبورد', desc: 'خلاصه و دسترسی سریع', keywords: ['داشبورد', 'داشبورد اصلی', 'صفحه اصلی', 'خلاصه', 'dashboard', 'اول'], steps: ['از این صفحه خلاصه مصرف و گفتگوها را ببینید.', 'از دسترسی سریع یا «میخوای چه کار کنی؟» به بخش موردنظر بروید.'] },
  { href: '/settings', label: 'تنظیمات', desc: 'اطلاعات کاربری و تنظیمات حساب', keywords: ['تنظیمات', 'پروفایل', 'نام', 'شماره', 'حساب کاربری', 'settings', 'ویرایش پروفایل'], steps: ['وارد تنظیمات شوید.', 'نام، ایمیل یا شماره را ویرایش کنید و ذخیره کنید.'] },
  { href: '/settings/api-keys', label: 'کلیدهای API', desc: 'کلید برای دسترسی برنامه‌نویسی', keywords: ['کلید api', 'api key', 'کلید برنامه', 'توکن', 'developer key'], steps: ['وارد بخش کلیدهای API شوید.', 'کلید جدید بسازید یا کلید موجود را کپی کنید.', 'در برنامه یا اسکریپت خود از کلید استفاده کنید.'] },

  // ── چت و استودیوها ──
  { href: '/chat', label: 'چت هوشمند', desc: 'چت با هوش مصنوعی', keywords: ['چت', 'گفتگو', 'سوال', 'پرسش', 'هوش مصنوعی', 'ربات', 'مکالمه', 'chat', 'سوال بپرسم', 'جواب بگیرم', 'کمک بگیرم', 'بپرسم'], steps: ['وارد چت هوشمند شوید.', 'گفتگوی جدید بسازید یا یکی را انتخاب کنید.', 'مدل را انتخاب کنید و پیام خود را بنویسید و ارسال کنید.'] },
  { href: '/text-studio', label: 'استودیو متن', desc: 'نوشتن و تولید متن', keywords: ['متن', 'مقاله', 'نوشتن', 'تولید متن', 'محتوا', 'ترجمه', 'text', 'بنویسم', 'مقاله بنویسم', 'بازنویسی'], steps: ['وارد استودیو متن شوید.', 'موضوع یا دستور (پرامپت) را وارد کنید.', 'مدل و پارامترها را انتخاب و تولید کنید.', 'خروجی را کپی یا دانلود کنید.'] },
  { href: '/image-studio', label: 'استودیو تصویر', desc: 'خلق و تولید تصویر', keywords: ['تصویر', 'عکس', 'تولید تصویر', 'نقاشی', 'طراحی', 'image', 'عکس بسازم', 'تصویر بسازم', 'ایمیج'], steps: ['وارد استودیو تصویر شوید.', 'توضیح تصویر (پرامپت) را بنویسید.', 'سبک و نسبت تصویر را انتخاب کنید.', 'تولید را بزنید و تصویر را ذخیره کنید.'] },
  { href: '/audio-studio', label: 'استودیو صوت', desc: 'تبدیل متن به صدا و برعکس', keywords: ['صدا', 'صوت', 'تبدیل صدا', 'خواندن متن', 'متن به صدا', 'audio', 'تTS', 'استT', 'صداسازی', 'ویس'], steps: ['وارد استودیو صوت شوید.', 'برای TTS: متن را وارد کنید، صدا و مدل را انتخاب و پخش/دانلود کنید.', 'برای STT: فایل صوتی را آپلود کنید و متن استخراج‌شده را ببینید.'] },
  { href: '/video-studio', label: 'استودیو ویدئو', desc: 'تولید ویدیو با هوش مصنوعی', keywords: ['ویدئو', 'ویدیو', 'تولید ویدئو', 'تولید ویدیو', 'video', 'ویدئو بسازم', 'کلیپ', 'موشن'], steps: ['وارد استودیو ویدئو شوید.', 'پرامپت یا منبع ویدیو را وارد کنید.', 'مدل و تنظیمات را انتخاب و تولید را شروع کنید.', 'پس از اتمام، ویدیو را دانلود کنید.'] },

  // ── دستیارها (عمومی و تخصصی) ──
  { href: '/agents', label: 'دستیارها', desc: 'لیست دستیارهای تخصصی', keywords: ['دستیار', 'ربات تخصصی', 'اژن', 'agent', 'دستیار تخصصی', 'لیست دستیار'], steps: ['وارد بخش دستیارها شوید.', 'دستیار موردنظر (ورزش، سفر، آشپزی و ...) را انتخاب کنید.', 'ورک‌اسپیس را باز کنید و در چت سوال یا درخواست خود را بپرسید.'] },
  { href: '/agents/student-tutor', label: 'دستیار دانش‌آموز', desc: 'معلم هوشمند برای درس و تمرین', keywords: ['دانش\u200cآموز', 'معلم', 'درس', 'تمرین', 'ریاضی', 'علوم', 'تدریس', 'student', 'مدرسه'], steps: ['وارد دستیار دانش‌آموز شوید.', 'مبحث یا سوال را بنویسید.', 'در چت توضیح و تمرین دریافت کنید.'] },
  { href: '/agents/fitness-diet', label: 'دستیار ورزش و رژیم', desc: 'برنامه تمرینی و تغذیه', keywords: ['ورزش', 'رژیم', 'تناسب اندام', 'تغذیه', 'برنامه تمرینی', 'fitness', 'دایت', 'کاهش وزن'], steps: ['وارد دستیار ورزش و رژیم شوید.', 'سطح و هدف خود را از منو انتخاب کنید.', 'در چت برنامه تمرینی یا غذایی بخواهید.'] },
  { href: '/agents/travel-tourism', label: 'دستیار گردشگری', desc: 'برنامه سفر و مقصد', keywords: ['سفر', 'گردشگری', 'مقصد', 'برنامه سفر', 'طبیعت', 'travel', 'تور', 'مسافرت'], steps: ['وارد دستیار گردشگری شوید.', 'مقصد یا سبک سفر را از منو انتخاب کنید.', 'در چت برنامه سفر یا پیشنهاد مقصد بگیرید.'] },
  { href: '/agents/fashion', label: 'دستیار فشن و مد', desc: 'ست‌ساز و مشاوره استایل', keywords: ['فشن', 'مد', 'استایل', 'ست\u200cساز', 'کمد', 'لباس', 'fashion', 'پوشش', 'ست لباس', 'ست کنم', 'ست درست کنم', 'ست کردن', 'با لباس', 'لباس هام', 'چه بپوشم'], steps: ['وارد دستیار فشن شوید.', 'سبک یا مناسبت را انتخاب کنید.', 'در چت ست پیشنهادی یا مشاوره استایل بگیرید.'] },
  { href: '/agents/home', label: 'دستیار خانه‌داری و آشپزی', desc: 'دستور پخت و برنامه غذایی', keywords: ['آشپزی', 'خانه\u200cداری', 'دستور پخت', 'غذا', 'برنامه غذایی', 'home', 'پخت', 'خوراک', 'بپزم', 'قرمه سبزی', 'خورش', 'پختن', 'غذا درست کنم', 'دستور غذا', 'ناهار', 'شام'], steps: ['وارد دستیار آشپزی شوید.', 'نام غذا یا مواد اولیه را بگویید.', 'دستور پخت یا برنامه غذایی دریافت کنید.'] },
  { href: '/agents/finance', label: 'دستیار مالی و سرمایه‌گذاری', desc: 'تحلیل و واچ‌لیست', keywords: ['مالی', 'سرمایه\u200cگذاری', 'واچ\u200cلیست', 'تحلیل', 'finance', 'سهام', 'بورس', 'معامله'], steps: ['وارد دستیار مالی شوید.', 'سوال تحلیلی یا نام نماد را بپرسید.', 'واچ‌لیست یا تحلیل را در چت ببینید.'] },
  { href: '/agents/lifestyle', label: 'دستیار سبک زندگی', desc: 'روتین و برنامه‌ریزی روزانه', keywords: ['سبک زندگی', 'روتین', 'تسک', 'عادت', 'برنامه\u200cریزی روزانه', 'lifestyle', 'کارهای روزانه'], steps: ['وارد دستیار سبک زندگی شوید.', 'زمان آزاد یا اولویت‌ها را بگویید.', 'برنامه روز یا لیست کارها را دریافت کنید.'] },
  { href: '/agents/instagram-admin', label: 'یار ادمین اینستاگرام', desc: 'تقویم محتوا و کپشن', keywords: ['اینستاگرام', 'محتوا', 'ریلز', 'کپشن', 'هشتگ', 'برند', 'instagram', 'ادمین'], steps: ['وارد یار ادمین اینستاگرام شوید.', 'اطلاعات برند و لحن را در تنظیمات پر کنید.', 'در چت ایده محتوا، کپشن یا هشتگ بخواهید.'] },
  { href: '/agents/persian-pdf-maker', label: 'تبدیل به PDF فارسی', desc: 'متن یا ورد به PDF با کیفیت', keywords: ['pdf', 'فارسی', 'تبدیل pdf', 'ورد به pdf', 'persian pdf', 'سند فارسی'], steps: ['وارد تبدیل به PDF فارسی شوید.', 'متن را paste کنید یا فایل ورد را آپلود کنید.', 'عنوان و تنظیمات را وارد و PDF را تولید کنید.', 'فایل را دانلود کنید.'] },

  // ── مالی و صورتحساب ──
  { href: '/billing', label: 'صورتحساب', desc: 'خرید سکه و مدیریت اعتبار', keywords: ['صورتحساب', 'سکه', 'خرید سکه', 'پرداخت', 'اعتبار', 'شارژ', 'billing', 'مالی', 'واریز', 'تراکنش', 'موجودی', 'سکه بخرم'], steps: ['وارد صورتحساب شوید.', 'بسته سکه موردنظر را انتخاب کنید.', 'پرداخت را انجام دهید؛ پس از تایید، سکه به حساب اضافه می‌شود.'] },

  // ── پشتیبانی ──
  { href: '/support', label: 'پشتیبانی', desc: 'تیکت و تماس با پشتیبانی', keywords: ['پشتیبانی', 'تیکت', 'مشکل', 'کمک', 'تماس', 'support', 'خطا', 'گزارش', 'سوال از پشتیبانی', 'مشکل دارم'], steps: ['وارد پشتیبانی شوید.', 'تیکت جدید بسازید و موضوع و توضیح را بنویسید.', 'پاسخ را در همان تیکت یا ایمیل دریافت کنید.'] },

  // ── سازمان‌ها و تیم ──
  { href: '/organizations', label: 'سازمان‌ها', desc: 'مدیریت سازمان و اعضا', keywords: ['سازمان', 'تیم', 'اعضا', 'دعوت', 'organizations', 'سازمان\u200cها'], steps: ['وارد سازمان‌ها شوید.', 'سازمان بسازید یا یکی را انتخاب کنید.', 'اعضا را دعوت کنید یا نقش‌ها را مدیریت کنید.'] },

  // ── پایگاه دانش و ورک‌فلو ──
  { href: '/knowledge', label: 'پایگاه دانش', desc: 'RAG و جستجو در اسناد', keywords: ['دانش', 'پایگاه دانش', 'سند', 'رگ', 'rag', 'جستجو در سند', 'knowledge'], steps: ['وارد پایگاه دانش شوید.', 'پایگاه جدید بسازید و اسناد را آپلود کنید.', 'در چت یا جستجو از محتوای اسناد استفاده کنید.'] },
  { href: '/workflows', label: 'ورک‌فلوها', desc: 'اتوماسیون و گردش کار', keywords: ['ورکفلو', 'اتوماسیون', 'خودکار', 'workflow', 'گردش کار'], steps: ['وارد ورک‌فلوها شوید.', 'ورک‌فلو جدید بسازید یا یکی را ویرایش کنید.', 'مراحل را تعریف و ذخیره کنید و در صورت نیاز اجرا کنید.'] },
  { href: '/jobs', label: 'کارهای صف', desc: 'وضعیت کارهای در صف', keywords: ['صف', 'کارهای صف', 'jobs', 'وظایف', 'وضعیت کار'], steps: ['وارد کارهای صف شوید.', 'لیست کارهای در حال انجام یا تمام‌شده را ببینید.', 'در صورت نیاز کار را لغو یا دوباره اجرا کنید.'] },

  // ── مستندات و ادمین ──
  { href: '/developer', label: 'مستندات API', desc: 'اسناد و تست API', keywords: ['api', 'مستندات', 'developer', 'برنامه\u200cنویسی', 'سوئagger', 'docs'], steps: ['وارد مستندات API شوید.', 'اسناد و endpointها را بخوانید.', 'در صورت نیاز از Swagger یا ابزار تست استفاده کنید.'] },
  { href: '/admin', label: 'پنل ادمین', desc: 'مدیریت سیستم', keywords: ['ادمین', 'پنل ادمین', 'مدیریت', 'admin'], steps: ['وارد پنل ادمین شوید.', 'بخش موردنظر (کاربران، تنظیمات، منوها و ...) را انتخاب کنید.', 'تغییرات را اعمال و ذخیره کنید.'] },
];

/**
 * متن کاربر را با کلیدواژه‌ها مقایسه می‌کند و بهترین بخش را برمی‌گرداند.
 * فقط بخش‌هایی که در allowedHrefs هستند پیشنهاد می‌شوند.
 */
export function matchIntent(
  text: string,
  allowedHrefs: Set<string>
): IntentTarget | null {
  const t = text.trim().toLowerCase();
  if (!t) return null;
  let best: IntentTarget | null = null;
  let bestScore = 0;
  for (const target of INTENT_TARGETS) {
    if (!allowedHrefs.has(target.href)) continue;
    for (const kw of target.keywords) {
      if (t.includes(kw.toLowerCase())) {
        const score = kw.length;
        if (score > bestScore) {
          bestScore = score;
          best = target;
        }
      }
    }
  }
  return best;
}

/** مجموعه همهٔ hrefهای قابل پیشنهاد (برای وقتی که فیلتر منو لازم نیست) */
export const ALL_INTENT_HREFS = new Set(INTENT_TARGETS.map((x) => x.href));
