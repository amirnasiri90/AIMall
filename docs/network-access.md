# دسترسی به سایت از طریق شبکه (IP)

برای باز کردن سایت از سیستم‌های دیگر (موبایل، لپ‌تاپ دیگر در همان شبکه) با آدرس IP و جلوگیری از خطای **Load failed** / **Failed to fetch**:

## ۱. پروکسی API (فعلی)

فرانت‌اند (Next.js) درخواست‌های API را به بک‌اند **پروکسی** می‌کند. یعنی از گوشی/سیستم دیگر فقط به **یک آدرس** (همان فرانت روی پورت 3000) وصل می‌شوید و همهٔ درخواست‌ها از همان دامنه می‌روند؛ دیگر نیازی به باز بودن پورت 3001 در فایروال برای دستگاه‌های خارجی نیست.

- در مرورگر آدرس API به‌صورت **نسبی** است: `/api/v1`
- Next با `rewrites` درخواست‌های `/api/v1/*` را به `http://127.0.0.1:3001/api/v1/*` می‌فرستد.

## ۲. اجرای سرورها

```bash
# ترمینال ۱ — بک‌اند (همان ماشین، روی 3001)
cd backend && npm run start

# ترمینال ۲ — فرانت‌اند (با hostname 0.0.0.0 تا از شبکه قابل دسترسی باشد)
cd frontend && npm run dev
```

- **بک‌اند** روی `0.0.0.0:3001` گوش می‌دهد (فقط روی همان ماشین لازم است؛ پروکسی از فرانت به آن وصل می‌شود).
- **فرانت‌اند** با `--hostname 0.0.0.0` روی پورت 3000 از شبکه در دسترس است.

## ۳. فایروال ویندوز

برای دسترسی از **گوشی یا سیستم دیگر** فقط پورت **3000** را باز کنید (پورت 3001 لازم نیست؛ پروکسی از داخل همان ماشین استفاده می‌شود):

```powershell
# با دسترسی Administrator
netsh advfirewall firewall add rule name="AIMall Frontend 3000" dir=in action=allow protocol=TCP localport=3000
```

یا از اسکریپت پروژه (هر دو پورت را باز می‌کند):

```powershell
cd backend\scripts
.\allow-ports-3000-3001-firewall.ps1
```

## ۴. دسترسی از دستگاه دیگر

1. **پیدا کردن IP ویندوز:** در CMD یا PowerShell بنویسید: `ipconfig` و آدرس **IPv4** کارت شبکهٔ وای‌فای/اترنت را ببینید (مثلاً `192.168.1.100`).
2. در مرورگر دستگاه دیگر (موبایل یا لپ‌تاپ دیگر در همان شبکه) باز کنید: **http://192.168.1.100:3000**

اگر باز هم **Load failed** یا **Failed to fetch** دیدید:

1. **تست دسترسی به فرانت:** از دستگاه دیگر در مرورگر باز کنید:  
   `http://YOUR_IP:3000/api/ping`  
   اگر پاسخ `{"ok":true}` دیدید، فرانت از شبکه در دسترس است. اگر نه:
   - فرانت را حتماً با **`npm run dev`** (نه `next dev` مستقیم) اجرا کنید تا با `--hostname 0.0.0.0` بالا بیاید.
   - در فایروال ویندوز پورت **3000** را باز کنید (PowerShell با Administrator:  
     `netsh advfirewall firewall add rule name="AIMall 3000" dir=in action=allow protocol=TCP localport=3000`).

2. **تست پروکسی API:** بعد از لاگین، داشبورد درخواست به `/api/v1/auth/me` می‌زند. اگر فرانت در دسترس است ولی داشبورد لود نمی‌شود:
   - روی همان ماشینی که سرورها را اجرا کرده‌اید، بک‌اند باید روی پورت 3001 در حال اجرا باشد (`npm run start:dev` در پوشهٔ backend).
   - هر دو دستگاه در **همان شبکه** باشند (همان وای‌فای یا همان سوییچ).

3. فرانت را بعد از تغییرات `next.config.mjs` حتماً **ری‌استارت** کنید.
