# راهنمای ساخت API Key و دسترسی‌های ElevenLabs برای AI Mall

این راهنما مراحل ساخت کلید API در ElevenLabs و تنظیم دسترسی‌های لازم برای استفاده در **استودیو صوت** (تبدیل متن به گفتار) را توضیح می‌دهد.

---

## پلن رایگان کافی است؟

**بله.** برای تست و استفادهٔ محدود نیازی به پلن پولی نیست. در پلن رایگان ElevenLabs:
- **API** (از جمله Text to Speech) فعال است.
- معمولاً حدود **۱۰٬۰۰۰ کاراکتر در ماه** (معادل حدود ۱۰ دقیقه صوت) سهمیه رایگان دارید.
- اگر خطای **۴۰۳** می‌گیرید، معمولاً به خاطر **جای ساخت کلید** (مثلاً ElevenAgents به‌جای تنظیمات پروفایل) یا **دسترسی کلید** است، نه به خاطر رایگان بودن پلن.

---

## ۱. ورود به ElevenLabs

1. به سایت [elevenlabs.io](https://elevenlabs.io) بروید.
2. با **ثبت‌نام** یا **ورود** یک اکانت بسازید (همان پلن رایگان کافی است).

---

## ۲. رفتن به صفحهٔ API Keys (مهم)

**توجه:** برای **تبدیل متن به گفتار (TTS)** باید کلید را از **تنظیمات اکانت** بسازید، نه از داخل پروژهٔ **ElevenAgents**.

- اگر داخل اپ ElevenLabs هستید و در سایدبار **Developers → API Keys** را می‌بینید (مثلاً زیر پروژه ElevenAgents)، آن کلیدها برای **Speech API** ممکن است دسترسی نداشته باشند و خطای ۴۰۳ بدهند.
- برای TTS حتماً از **صفحهٔ تنظیمات پروفایل** استفاده کنید:

1. بعد از ورود، روی **آیکون پروفایل** (بالا سمت راست) کلیک کنید.
2. گزینهٔ **Profile + API key** یا **Settings** را بزنید.
3. از منوی تنظیمات، **API Keys** را انتخاب کنید.  
   یا **مستقیماً** این لینک را باز کنید (صفحهٔ کلیدهای Speech API):  
   **https://elevenlabs.io/app/settings/api-keys**

---

## ۳. ساخت API Key جدید

1. روی دکمهٔ **Create API Key** یا **+ Add API Key** کلیک کنید.
2. یک **نام** برای کلید وارد کنید (مثلاً: `AI Mall` یا `Production`).
3. در بخش **دسترسی‌ها (Permissions / Scopes)** حتماً این موارد را فعال کنید:
   - **Text to Speech** یا **TTS** — برای تولید صوت از متن (ضروری برای استودیو صوت).
   - در صورت وجود: **Voices** یا **Read voices** — برای لیست صداها و تست اتصال کامل (اختیاری؛ اگر نبود، فقط TTS کافی است).
4. در صورت وجود **Credit quota**، سقف اعتبار را مطابق نیاز تنظیم کنید (برای تست می‌توان خالی گذاشت یا عدد کوچک).
5. **Create** یا **Save** را بزنید.
6. **کلید را یک‌بار نمایش داده و کپی کنید.** بعد از بستن صفحه معمولاً دیگر کلید کامل نمایش داده نمی‌شود.

---

## ۴. قرار دادن کلید در پنل ادمین AI Mall

1. در AI Mall وارد **پنل ادمین** شوید.
2. به بخش **ارائه‌دهندگان** (AI Providers) بروید.
3. **ElevenLabs** را پیدا کنید و روی **تنظیم** یا **ویرایش** کلیک کنید.
4. در فیلد **API Key**، کلید کپی‌شده از ElevenLabs را paste کنید.
5. **ذخیره** را بزنید.
6. دکمهٔ **تست اتصال** را بزنید:
   - اگر پیام **«اتصال موفق»** یا **«کلید معتبر است. دسترسی به لیست صداها (۴۰۳) ندارید؛ تولید متن به صوت باید کار کند.»** آمد، کلید و دسترسی‌ها درست است.
   - اگر **۴۰۳** دیدید، در ElevenLabs دوباره دسترسی **Text to Speech** را برای همان API key بررسی کنید.

---

## ۵. دسترسی‌های لازم (خلاصه)

| دسترسی            | الزامی برای AI Mall | توضیح |
|-------------------|---------------------|--------|
| **Text to Speech (TTS)** | بله                 | برای تولید صوت در استودیو صوت. |
| **Voices** (در صورت وجود) | خیر (ترجیحی)       | برای لیست صداها و تست اتصال کامل؛ بدون آن هم TTS کار می‌کند. |

اگر فقط **TTS** فعال باشد و **Voices** غیرفعال یا محدود باشد، تست اتصال ممکن است با پیام ۴۰۳ برای لیست صداها مواجه شود؛ در آن حالت اگر تست جایگزین (TTS) موفق باشد، همان پیام «تولید متن به صوت باید کار کند» نمایش داده می‌شود و می‌توانید از استودیو صوت استفاده کنید.

---

## ۶. عیب‌یابی

- **۴۰۱ Unauthorized:** کلید اشتباه یا منقضی است؛ کلید جدید بسازید و در پنل ادمین جایگزین کنید.
- **۴۰۳ Forbidden:** دسترسی API key برای آن endpoint کافی نیست. دو مورد را حتماً چک کنید:
  1. **صفحهٔ درست:** در مرورگر یک تب جدید باز کنید و **دقیقاً** این آدرس را بزنید: **https://elevenlabs.io/app/settings/api-keys** (باید در آدرس کلمهٔ **settings** باشد، نه فقط developers). اگر همان صفحهٔ Developers با تب API Keys باز شد، بروید سراغ مورد ۲.
  2. **دسترسی هنگام ساخت کلید:** وقتی روی **+ Create Key** کلیک می‌کنید، در همان پنجره/مرحلهٔ ساخت باید **Access levels** یا **Permissions** یا **Scopes** باشد. حتماً **Text to Speech** (یا TTS / Synthesize) را تیک بزنید و بعد Create کنید. اگر برای کلید فعلی می‌توانید دسترسی عوض کنید، روی منوی **⋯** کنار کلید کلیک کنید و **Edit** یا **Permissions** را بزنید و TTS را فعال کنید.
- **۴۲۹ Too Many Requests:** سهمیه یا اعتبار اکانت ElevenLabs تمام شده؛ پلن یا اعتبار را در elevenlabs.io بررسی کنید.

---

## اگر هنوز ۴۰۳ می‌گیرید (همهٔ مراحل را انجام دادید)

1. **تست اتصال را دوباره بزنید** و بخش **«پاسخ ElevenLabs»** را باز کنید. الان در پاسخ می‌بینید:
   - اگر **GET /v1/user → 200** باشد: کلید معتبر است ولی دسترسی TTS/Voices ندارد → در ElevenLabs برای همان کلید دسترسی **Text to Speech** را فعال کنید (منوی ⋯ کنار کلید → Edit / Permissions).
   - اگر **GET /v1/user → 403 یا 401** باشد: این کلید برای Speech API نیست → از لینک **elevenlabs.io/app/settings/api-keys** یک کلید **جدید** بسازید و فقط همان را در AI Mall استفاده کنید.

2. **کلید را بدون فاصله/خط جدید کپی کنید** — قبل و بعد کلید space یا Enter نباشد.

3. **از مرورگر دیگر یا حالت ناشناس** تست کنید (گاهی افزونه یا cache مشکل می‌سازد).

4. اگر با کلید جدید از صفحهٔ **settings** هم ۴۰۳ ماند، با **پشتیبانی ElevenLabs** تماس بگیرید و بگویید با User API key روی پلن رایگان به `/v1/voices` و `/v1/text-to-speech` دسترسی ندارید.

---

## لینک‌های مفید

- [مستندات احراز هویت ElevenLabs](https://elevenlabs.io/docs/api-reference/authentication)
- [صفحهٔ API Keys در داشبورد](https://elevenlabs.io/app/settings/api-keys)
